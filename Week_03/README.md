# 学习笔记-使用LL算法构建AST

## AST抽象语法树

**简介**

抽象语法树（abstract syntax code，AST）是源代码抽象语法结构的树状表示，树上的每个节点都表示源代码的一种结构。

抽象语法树的第一个特点为:不依赖于具体的文法。即上下文分析阶段采用的是上下文无文文法。无论是LL(1)文法，还是LR(1)，或者还是其它的方法，都要求在语法分析时候，构造出相同的语法树，这样可以给编译器后端提供了清晰，统一的接口。即使是前端采用了不同的文法，都只需要改变前端代码，而不用连累到后端。即减少了工作量，也提高的编译器的可维护性。

抽象语法树的第二个特点为:不依赖于语言的细节。在编译器家族中，大名鼎鼎的gcc算得上是一个老大哥了，它可以编译多种语言，例如c，c＋＋，java，ADA，Object C， FORTRAN， PASCAL， COBOL等等。在前端gcc对不同的语言进行词法，语法分析和语义分析后，产生抽象语法树形成中间代码作为输出，供后端处理。要做到这一点，就必须在构造语法树时，不依赖于语言的细节，例如在不同的语言中，类似于if－condition－then这样的语句有不同的表示方法。

抽象语法树在很多领域都有广泛的应用：比如浏览器、智能编辑器、编译器。

核心的语法分析算法有两种：一种是LL算法，一种是LR算法。L是Left的缩写。LL算法就是从左到右进行扫描，从左到右规约的一个缩写。

**构建流程**
对字符串的稍高级处理，使用LL算法构建AST。
1. 第一步词法分析，也叫scanner：读取代码，按照预定规则合并成一个个的标识tokens。同时，它会移除空白符、注释等。最后，整个代码将被分割进一个 tokens 列表（或者说一维数组）。
1. 第二步语法分析，也叫解析器：对编程语言分词，使这些词构成层层嵌套的语法树的树形结构。它会将词法分析出来的数组转换成树形的形式，同时，验证语法。语法如果有错的话，抛出语法错误。

## 1.四则运算

### 四则运算词法的定义
TokenNumber（数字） 和 Operator（运算符） 是有意义的输入，其他是编程格式化的输入。

1. TokenNumber: 0～9的组合，支持带小数点的输入
1. Operator: +、-、*、/ 之一
1. WhiteSpace: <SP>
1. LineTerminator: <LF> <CR>

### 四则运算语法的定义
加法和乘法的优先级关系，需要用JS的产生式去定义它的加法和乘法运算。把加、减、乘、除做成一个嵌套的结构。加法是由左右两个乘法组成的。

## 2.正则表达式
1. () 圆括号表示捕获
1. \t 表示tab
1. \r\n 表示换行符
1. 使用正则表达式的exec()方法扫描整个字符串里面的内容。

## 3.词法分析
1. 匹配的长度和前进的长度，使用一个函数级的lastIndex变量
2. 使用generator/yield方式处理token，使之变成异步的处理方式。

## 4. 语法分析
1. 每一个产生树对应一个函数处理
2. MultiplicativeExpression 处理乘法，有三种情况，（1)source[0].type是一个数字，(2)source[0].type是 MultiplicativeExpression 且source[1].type 是 '*'，(3)source[0].type是 MultiplicativeExpression 且source[1].type 是 '/'，对这些情况进行合并最后形成一个新对语法结构，产生一个非终结符。
3. AdditiveExpression 处理加法, AdditiveExpression 包含了 MultiplicativeExpression 的所有逻辑。